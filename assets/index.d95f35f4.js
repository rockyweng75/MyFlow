import{_ as N,L as g,V as A,h as w,W as U,r as _,o as r,c as u,j as p,w as y,F as f,z as v,a as k,B as h,l as B,t as T,M as R,u as S,g as b,f as F,X as D,i as x,k as j,A as C}from"./index.a74f1f35.js";import{C as E}from"./index.29a6cf0d.js";const P={props:{items:{type:[Array,Object]},data:{type:Object},readonly:{type:Boolean,default:!1}},components:{CustomItem:E},setup(d,{emit:c}){const t=g({}),a=()=>{if(t.items=[],d.items.some(e=>e.ItemType.toString().substring(0,1)==="2"&&e.ItemType.toString().length===3)){t.isAreas=!0,t.items=[];let e,n=null,l=0;d.items.forEach(m=>{n={...m},m.ItemType.toString().substring(0,1)==="2"?(e={...m},e.child=[],l=parseInt(m.ItemValue)):l>0?(e.child.push(n),--l==0&&t.items.push(e)):t.items.push(n)})}else t.isAreas=!1,t.items=d.items};A(()=>{a()}),w(()=>{d.items&&a()});const i=g({uploadFile:()=>new Promise(e=>e()),commit:()=>new Promise(e=>e()),rollback:()=>new Promise(e=>e())}),I=e=>{e&&e.uploadImageFile&&(i.uploadFile=e.uploadFile,i.commit=e.commit,i.rollback=e.rollback,i.hasUpload=!0)};return{...U(i),state:t,setRefForm:I}}},Y={key:0},z={key:1};function L(d,c,t,a,i,I){const e=_("CustomItem"),n=_("el-step"),l=_("el-steps"),m=_("el-card");return a.state.isAreas?(r(),u("div",Y,[a.state.items.some(o=>o.ItemType===202)?(r(),p(l,{key:0,direction:"vertical",active:99,"finish-status":"finish","process-status":"finish"},{default:y(()=>[(r(!0),u(f,null,v(a.state.items,o=>(r(),u(f,{key:o.ItemName},[o.ItemType===202?(r(),p(n,{key:0,title:o.ItemTitle,class:"custom-step"},{description:y(()=>[(r(!0),u(f,null,v(o.child,s=>(r(),u("div",{key:s.ItemName},[k(e,{item:s,ref_for:!0,ref:a.setRefForm,modelValue:t.data[s.ItemValue],"onUpdate:modelValue":V=>t.data[s.ItemValue]=V,disabled:s.Disabled==="Y",readonly:t.readonly},null,8,["item","modelValue","onUpdate:modelValue","disabled","readonly"])]))),128))]),_:2},1032,["title"])):h("",!0)],64))),128))]),_:1})):(r(!0),u(f,{key:1},v(a.state.items,o=>(r(),u(f,{key:o.ItemName},[o.ItemType===201?(r(),p(m,{key:0,class:R(o.ItemDesc)},{header:y(()=>[B(T(o.ItemTitle),1)]),default:y(()=>[(r(!0),u(f,null,v(o.child,s=>(r(),p(e,{key:s.ItemName,item:s,ref_for:!0,ref:a.setRefForm,modelValue:t.data[s.ItemValue],"onUpdate:modelValue":V=>t.data[s.ItemValue]=V,disabled:s.Disabled==="Y",readonly:t.readonly},null,8,["item","modelValue","onUpdate:modelValue","disabled","readonly"]))),128))]),_:2},1032,["class"])):h("",!0)],64))),128))])):(r(),u("div",z,[(r(!0),u(f,null,v(a.state.items,o=>(r(),p(e,{key:o.ItemName,item:o,ref_for:!0,ref:a.setRefForm,modelValue:t.data[o.ItemValue],"onUpdate:modelValue":s=>t.data[o.ItemValue]=s,disabled:o.Disabled==="Y",readonly:t.readonly},null,8,["item","modelValue","onUpdate:modelValue","disabled","readonly"]))),128))]))}const M=N(P,[["render",L],["__scopeId","data-v-735f2024"]]),O={components:{CustomItems:M},props:{flowid:{type:[Number,String],required:!0},disabled:{type:Boolean},readonly:{type:Boolean}},setup(d){const c=S(),t=b(()=>c.getters["form/selectedForm"]),a=b(()=>c.getters["form/items"]),i=b(()=>c.getters["user/userInfo"]),I=b(()=>c.getters["process/applyData"]),e=F(!0),n=g({formData:{...I.value},userInfo:i.value});D("userInfo",n.userInfo),D("formData",n.formData),w(()=>{c.dispatch("form/getApplyForm",d.flowid).then(()=>{a.value&&a.value.forEach(s=>{n.formData[s.ItemValue]||(n.formData[s.ItemValue]="")}),e.value=!1})});const l=F({}),m=F();return{formData:I,state:n,items:a,form:t,refForm:l,setRefForm:s=>{l.value=s,l.value&&m.value&&(l.value.uploadFile=()=>m.value.uploadFile(),l.value.commit=()=>m.value.commit(),l.value.rollback=()=>m.value.rollback())},loading:e}}};function q(d,c,t,a,i,I){const e=_("CustomItems"),n=_("el-form"),l=_("el-card"),m=x("loading");return j((r(),p(l,{class:"blue-card"},{header:y(()=>[B(" \u7533\u8ACB"+T(a.form.FlowName),1)]),default:y(()=>[k(n,{model:a.state.formData,ref:"refForm"},{default:y(()=>[k(e,{ref:"customItems",items:a.items,data:a.state.formData,disabled:t.disabled,readonly:t.readonly},null,8,["items","data","disabled","readonly"]),C(d.$slots,"button",{form:a.refForm,data:a.state.formData})]),_:3},8,["model"]),C(d.$slots,"default")]),_:3})),[[m,a.loading]])}const G=N(O,[["render",q]]);export{G as A,M as C};
