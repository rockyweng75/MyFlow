import{_ as D,u as O,g as C,L as E,r,o as p,j as g,w as l,A as P,a3 as S,U as j,e as H,h as L,i as R,c as F,k as U,a as i,B,F as x,a4 as M,E as k,z,l as h,t as I}from"./index.a74f1f35.js";import{A as q}from"./index.d95f35f4.js";import{A as G}from"./index.591bfa79.js";import"./index.29a6cf0d.js";const J={props:["modelValue","title"],emits:["update:modelValue"],setup(n,{emit:o}){const t=O(),e=C(()=>t.getters["app/device"]!=="desktop"),m=C(()=>t.getters["app/device"]!=="desktop"?"100%":"80%"),d=E({dialogVisible:n.modelValue});return{state:d,fullscreen:e,width:m,handleClose:()=>{o("update:modelValue",d.dialogVisible)},handleOpen:()=>{},updateAction:()=>{},deleteAction:()=>{},closeAction:()=>{o("update:modelValue",!1)}}}};function K(n,o,t,e,m,d){const s=r("el-dialog");return p(),g(s,{title:t.title,modelValue:t.modelValue,"onUpdate:modelValue":o[0]||(o[0]=u=>t.modelValue=u),width:e.width,"show-close":!1,fullscreen:e.fullscreen,"close-on-press-escape":!1,"close-on-click-modal":!1,"destroy-on-close":!0,onClosed:e.handleClose,onOpen:e.handleOpen,center:""},{default:l(()=>[P(n.$slots,"default")]),_:3},8,["title","modelValue","width","fullscreen","onClosed","onOpen"])}const Q=D(J,[["render",K]]),W={components:{ApplyForm:q,ProcessHistory:S({loader:()=>M(()=>import("./index.cf388ad6.js"),["assets/index.cf388ad6.js","assets/index.630469d0.css","assets/index.a74f1f35.js","assets/index.1ce94655.css"]),delay:200}),ApproveForm:G,Details:Q},props:["flowid","disabled"],setup(){const n=j(),o=H(),t=E({stageid:n.params.stageid,flowid:n.params.flowid,applyid:n.params.applyid,apprid:n.params.apprid,dialogVisible:!1,action:"",actionTitle:"",loading:!0}),e=O();L(()=>{e.dispatch("process/load",n.params.apprid).then(()=>{t.loading=!1})});const m=C(()=>e.getters["process/actionForms"]),d=()=>{t.dialogVisible=!0,t.action="agree",t.actionTitle="\u540C\u610F\u9001\u51FA"},s=()=>{t.dialogVisible=!0,t.action="disagree",t.actionTitle="\u4E0D\u540C\u610F\u9001\u51FA"};return{state:t,agree:d,disagree:s,submit:(c,f,b)=>{c.validate(w=>{if(w)new Promise((a,V)=>{f.uploadFile().then(()=>{var _=null;t.action==="agree"?_=e.dispatch("process/agree",b):t.action==="disagree"?_=e.dispatch("process/disagree",b):alert(t.actionTitle+"has a error"),_.then(N=>{N.Success?(k.success("\u9001\u51FA\u6210\u529F"),t.dialogVisible=!1,f.commit(),o.go(-1)):(k.error("\u9001\u51FA\u5931\u6557"),t.dialogVisible=!1,f.rollback())})}).catch(_=>{k.error("\u9001\u51FA\u5931\u6557")}),a()});else return console.log("error submit!!"),k.error("\u8ACB\u88DC\u586B\u5FC5\u586B\u6B04\u4F4D"),!1})},cancel:()=>{t.dialogVisible=!1,t.actionTitle=""},comeback:()=>{o.go(-1)},actionForms:m,getButtonType:c=>c.ActionType==1?"primary":c.ActionType==2?"danger":"info",hanldClick:c=>c.ActionType==1?d():c.ActionType==2?s():()=>{}}}};function X(n,o,t,e,m,d){const s=r("el-button"),u=r("el-button-group"),y=r("el-col"),v=r("el-row"),A=r("el-divider"),T=r("ApproveForm"),c=r("Details"),f=r("ApplyForm"),b=r("ProcessHistory"),w=R("loading");return p(),F(x,null,[U((p(),g(v,{class:"block",justify:"space-between"},{default:l(()=>[i(y,{span:12},{default:l(()=>[i(u,null,{default:l(()=>[(p(!0),F(x,null,z(e.actionForms,(a,V)=>(p(),g(s,{key:V,type:e.getButtonType(a),onClick:_=>e.hanldClick(a)},{default:l(()=>[h(I(a.ButtonName),1)]),_:2},1032,["type","onClick"]))),128))]),_:1})]),_:1}),i(y,{span:12,style:{"text-align":"end"}},{default:l(()=>[i(s,{type:"warning",onClick:o[0]||(o[0]=a=>e.comeback())},{default:l(()=>[h("\u8FD4\u56DE")]),_:1})]),_:1})]),_:1})),[[w,e.state.loading]]),i(c,{modelValue:e.state.dialogVisible,"onUpdate:modelValue":o[2]||(o[2]=a=>e.state.dialogVisible=a),title:e.state.actionTitle},{default:l(()=>[i(T,{stageid:e.state.stageid,action:e.state.action},{button:l(a=>[i(A),i(u,null,{default:l(()=>[i(s,{type:"primary",onClick:V=>e.submit(a.form,a.file,a.data)},{default:l(()=>[h("\u9001\u51FA")]),_:2},1032,["onClick"]),i(s,{type:"danger",onClick:o[1]||(o[1]=V=>e.cancel())},{default:l(()=>[h("\u53D6\u6D88")]),_:1})]),_:2},1024)]),_:1},8,["stageid","action"])]),_:1},8,["modelValue","title"]),e.state.loading?B("",!0):(p(),g(f,{key:0,class:"disabled-form",flowid:e.state.flowid,disabled:!0},null,8,["flowid"])),e.state.loading?B("",!0):(p(),g(b,{key:1,applyid:e.state.applyid,apprid:e.state.apprid,hidden:e.state.apprid,disabled:!0},null,8,["applyid","apprid","hidden"]))],64)}const te=D(W,[["render",X]]);export{te as default};
